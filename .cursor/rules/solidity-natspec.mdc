---
description: Solidity NatSpec conventions (first-party)
globs: "{src,script,test}/**/*.{sol,s.sol,t.sol}"
alwaysApply: false
---

# Solidity NatSpec (project style)

Follow this NatSpec style when editing first-party Solidity under `src/`, `script/`, and `test/` (do not modify vendored/dependency code under `lib/`).

## General principles

- Prefer documenting **behavior, assumptions, invariants, and trust boundaries** over narrating syntax.
- Keep docs **truthful** (describe what the code does today, not intended behavior).
- Use `@notice` for the primary “what/outcome”; use `@dev` for edge cases, auth, ordering, and gotchas.
- Use short paragraphs and blank `///` separators (match the Flywheel/CashbackRewards examples).

## Contract headers

At the contract level, use:

- `/// @title <Name>`
- blank `///`
- `/// @notice <Protocol-level summary>`
- optional `/// @dev` bullets for constraints/assumptions
- blank `///`
- `/// @author <Org> (<repo link>)` when appropriate

## Sections and ordering

- Use section dividers (e.g. `//////////////////////////////////////////////////////////////`) **only** when they improve readability and the file is long enough to benefit.
- Prefer grouping into: Types, Constants/Immutables, Storage, Events, Errors, Modifiers, Constructor, External, Public, Internal, Private.

## Types (struct/enum)

- Add `/// @notice` describing the type’s purpose.
- Add per-field docs using `/// @dev` for meaning, units, and constraints.
- If a type participates in EIP-712 hashing/signatures, document the binding between fields and the signed intent in `@dev`.

## State variables / constants / immutables

- Add `/// @notice` describing what the value represents (include units like `wad`, `bps`, `seconds`, `wei` where relevant).
- For mappings, describe the key-space and what values mean (including sentinel values such as “0 means unset”).

## Events

For each event:

- `/// @notice` describes the business event.
- blank `///`
- `/// @param <name> <meaning>` for every field (avoid type narration).

## Errors

For each custom error:

- `/// @notice` describes when it is thrown.
- optional `/// @dev` for applicability (“applies to X and Y paths”, “only for relayed calls”, etc.)
- `@param` docs for error fields.

## Modifiers

- `/// @notice` describes the guard.
- `@param` docs for modifier parameters.

## Functions (all visibilities)

For every function (including internal/private when it clarifies protocol assumptions):

- `/// @notice` one-sentence summary of effect/outcome.
- Optional `/// @dev` covering:
  - **auth model** (who can call, what signatures are required, relayer expectations)
  - **idempotency** / replay behavior / nonce usage
  - **side effects** and ordering constraints (“emits before calling hooks”, “updates state before external call”)
  - **edge cases** (zero amounts, empty arrays, boundary timestamps, optional calldata)
- blank `///`
- `@param` for every argument.
- blank `///`
- `@return` for every return value (semantic meaning).

### Overrides / inheritdoc

- If the parent interface/base fully describes behavior, prefer `/// @inheritdoc <Base>` and add `@dev` only for deltas/extra constraints.
- If the override meaningfully changes behavior, use full NatSpec (and do not rely solely on `@inheritdoc`).

## Tests (`test/**/*.t.sol`)

- Document test contracts and key helper functions.
- Do not add verbose NatSpec for every single test unless it adds real clarity; prefer concise intent statements for complex invariants.

## Quick checklist (before you stop)

- All `@param` / `@return` names match the signature.
- Units are explicit where non-obvious (e.g., `wad`, `bps`, seconds).
- Auth/trust boundaries are stated for entrypoints and hooks.
- Any “escape hatch” or idempotent behavior is explicitly documented.
